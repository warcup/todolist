:root {
    --glass-bg: rgba(255, 255, 255, 0.65);
    --glass-sidebar: rgba(30, 30, 30, 0.65);
    --glass-card: rgba(255, 255, 255, 0.55);
    --glass-border: 1px solid rgba(255, 255, 255, 0.3);
    --primary: #007AFF; --danger: #FF3B30; --warning: #FF9500; --success: #34C759;
    --quad-primary: #7AB9FF; --quad-danger: #FF8A80; --quad-warning: #FFC77A; --quad-success: #8BE4A5;
    --text-dark: #1d1d1f; --text-light: #f5f5f7; --blur: blur(25px); --tab-height: 60px;
}
* { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, "SF Pro Text", sans-serif; -webkit-tap-highlight-color: transparent; outline: none; user-select: none;}
input, textarea { -webkit-user-select: text !important; user-select: text !important; }

body {
    background: url('https://images.unsplash.com/photo-1579546929518-9e396f3cc809?q=80&w=2560') no-repeat center center fixed;
    background-size: cover; height: 100vh; overflow: hidden; display: flex; color: var(--text-dark); font-size: 14px;
}

/* 基础组件 */
.btn { background: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.9rem; display: inline-flex; align-items: center; justify-content: center; gap: 5px; transition: 0.2s; }
.btn:active { transform: scale(0.96); }
.btn-sm { padding: 4px 10px; font-size: 0.8rem; }
.btn-danger { background: var(--danger); }
.btn-secondary { background: rgba(0,0,0,0.1); color: #333; }
.btn-text { background: transparent; color: var(--primary); border: none; cursor: pointer; padding: 0; }
.btn-icon { background: rgba(0,0,0,0.05); border: none; cursor: pointer; width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 1rem; }
.btn-icon:active { transform: scale(0.96); }
.trash-drop.is-drag-over {
    background: rgba(220, 20, 60, 0.12);
    box-shadow: 0 0 0 2px rgba(220, 20, 60, 0.2);
}

/* 布局 */
#sidebar { width: 210px; background: var(--glass-sidebar); backdrop-filter: var(--blur); padding: 16px 10px; display: flex; flex-direction: column; gap: 5px; color: var(--text-light); z-index: 100; border-right: var(--glass-border); transition: width 0.2s ease; }
#sidebar.is-collapsed { width: 64px; padding: 16px 6px; }
.sidebar-header { display: flex; align-items: center; justify-content: space-between; gap: 8px; padding: 0 6px 10px; }
.sidebar-title { color: white; font-size: 1.1rem; margin: 0; }
.sidebar-toggle { border: none; background: rgba(255,255,255,0.12); color: white; width: 32px; height: 32px; border-radius: 10px; cursor: pointer; font-size: 0.8rem; }
#sidebar.is-collapsed .sidebar-title { display: none; }
#sidebar.is-collapsed .sidebar-header { justify-content: center; }
#sidebar.is-collapsed .sidebar-toggle { width: 36px; }
.nav-icon { width: 20px; text-align: center; }
.nav-label { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
#sidebar.is-collapsed .nav-section { display: none; }
#sidebar.is-collapsed .nav-label { display: none; }
#sidebar.is-collapsed .nav-item { justify-content: center; padding: 10px 8px; }
#tag-filter-list { max-height: 180px; overflow-y: auto; margin-bottom: 10px; scrollbar-width: none; }
#tag-filter-list::-webkit-scrollbar { display: none; }
.nav-item .tag-more { flex-shrink: 0; }
#main { flex: 1; background: var(--glass-bg); backdrop-filter: var(--blur); display: flex; flex-direction: column; overflow: hidden; position: relative; }
.app-footer {
    flex: 0 0 auto;
    padding: 10px 20px 14px;
    font-size: 0.75rem;
    color: rgba(0,0,0,0.45);
    text-align: center;
}
.app-footer a {
    color: inherit;
    text-decoration: none;
}
.app-footer a:hover {
    text-decoration: underline;
}
#mobile-tabbar { display: none; position: fixed; bottom: 0; left: 0; right: 0; height: calc(var(--tab-height) + env(safe-area-inset-bottom, 0px)); padding-bottom: env(safe-area-inset-bottom, 0px); background: rgba(255,255,255,0.9); border-top: 1px solid #eee; justify-content: space-around; align-items: center; z-index: 900; }
#mobile-tabbar .tab-item { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; padding: 8px 4px; cursor: pointer; color: #555; }
#mobile-tabbar .tab-item[data-view="recycle"] { display: none; }

/* 导航与工具栏 */
.toolbar { height: 64px; display: flex; align-items: center; justify-content: space-between; padding: 0 25px; background: rgba(255,255,255,0.2); border-bottom: var(--glass-border); flex-shrink: 0; }
.search-bar { background: rgba(255,255,255,0.4); border: 1px solid rgba(255,255,255,0.5); border-radius: 20px; padding: 6px 15px; display: flex; align-items: center; width: 240px; transition: 0.3s; }
.search-bar:focus-within { background: white; width: 300px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.search-input { border: none; background: transparent; width: 100%; margin-left: 8px; font-size: 0.9rem; }
.toolbar-search { display: flex; align-items: center; gap: 10px; }

.nav-section { margin-top: 20px; margin-bottom: 5px; padding-left: 15px; font-size: 0.75rem; font-weight: 700; opacity: 0.5; text-transform: uppercase; letter-spacing: 1px; }
.nav-item { padding: 10px 15px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.2s; opacity: 0.8; font-weight: 500; font-size: 0.9rem; color: rgba(255,255,255,0.9); }
.nav-item:hover { background: rgba(255,255,255,0.15); opacity: 1; }
.nav-item.active { background: var(--primary); color: white; opacity: 1; box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3); }
#sidebar .nav-item[data-view="recycle"] { display: none; }
.tag-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--warning); margin-right: 5px; }

/* 视图切换器 */
.view-switcher { background: rgba(0,0,0,0.05); padding: 3px; border-radius: 8px; display: flex; gap: 2px; }
.view-switch-btn { padding: 4px 12px; border-radius: 6px; border: none; background: transparent; cursor: pointer; font-size: 0.85rem; font-weight: 500; color: #555; }
.view-switch-btn.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

.cal-date-extra { display: flex; justify-content: center; gap: 10px; font-size: 0.75rem; color: #666; margin-bottom: 10px; flex-wrap: wrap; }
.lunar-text { font-size: 0.7rem; color: #888; }
.holiday-tag { font-size: 0.7rem; padding: 1px 5px; border-radius: 6px; background: rgba(0,0,0,0.06); color: #333; display: inline-block; }
.holiday-tag.off { background: rgba(52,199,89,0.18); color: var(--success); }
.holiday-tag.work { background: rgba(255,59,48,0.18); color: var(--danger); }
.holiday-tag.placeholder { background: transparent; color: transparent; }
.week-header .holiday-tag { display: block; height: 16px; line-height: 16px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.month-cell .holiday-tag { display: block; height: 16px; line-height: 16px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

.view-container { flex: 1; overflow-y: auto; padding: 20px; display: none; }
.view-container.active { display: block; animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from{opacity:0; transform:translateY(5px)} to{opacity:1; transform:translateY(0)} }

/* 任务卡片 */
.task-card { background: white; border-radius: 10px; padding: 12px 15px; margin-bottom: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); display: flex; align-items: flex-start; gap: 12px; transition: 0.2s; border-left: 4px solid transparent; cursor: pointer; position: relative; }
.task-card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
.task-card.completed { opacity: 0.6; background: #f9f9f9; }
.task-title { color: var(--text-dark); }
.task-card.completed .task-title { text-decoration: line-through; color: var(--text-dark); opacity: 0.8; }
.task-card.dragging { opacity: 0.5; transform: scale(0.95); box-shadow: 0 10px 20px rgba(0,0,0,0.2); z-index: 100; }
.task-card.is-active { outline: 2px solid rgba(0,122,255,0.2); }
.task-card.menu-open { z-index: 30; }
.task-edit-btn { position: absolute; top: 8px; right: 8px; border: none; background: rgba(0,0,0,0.05); color: #333; width: 26px; height: 26px; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 700; line-height: 1; display: inline-flex; align-items: center; justify-content: center; letter-spacing: 1px; }
.task-edit-btn:hover { background: rgba(0,0,0,0.12); }
.task-card-menu {
    position: absolute;
    top: 36px;
    right: 8px;
    min-width: 96px;
    background: white;
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 10px;
    box-shadow: 0 10px 24px rgba(0,0,0,0.12);
    overflow: hidden;
    z-index: 20;
    display: flex;
    flex-direction: column;
}
.task-card-menu-item {
    background: transparent;
    border: none;
    text-align: left;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 0.85rem;
    color: #333;
}
.task-card-menu-item:hover { background: rgba(0,0,0,0.05); }
.task-card-menu-item.danger { color: #c62828; }

/* 子任务样式 */
.card-subtask-list { margin-top: 8px; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 6px; display: flex; flex-direction: column; gap: 4px; pointer-events: auto; }
.card-subtask-item { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; color: #666; cursor: pointer; padding: 2px 4px; border-radius: 4px; transition: background 0.2s; }
.card-subtask-item:hover { background: rgba(0,0,0,0.04); }
.sub-checkbox { width: 14px; height: 14px; border: 1.5px solid #bbb; border-radius: 3px; display: flex; align-items: center; justify-content: center; background: white; flex-shrink: 0; transition: 0.2s; cursor: pointer; }
.sub-checkbox.checked { background: var(--success); border-color: var(--success); }
.sub-checkbox.checked::after { content: '✓'; color: white; font-size: 9px; font-weight: bold; }
.sub-checkbox.disabled { cursor: not-allowed; opacity: 0.5; }
.card-subtask-title { cursor: pointer; }

/* Checkbox & Tag */
.checkbox { width: 18px; height: 18px; border: 2px solid #aaa; border-radius: 5px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; cursor: pointer; background: white; transition: 0.2s; }
.checkbox:hover { border-color: var(--primary); }
.checkbox.disabled { cursor: not-allowed; opacity: 0.5; }
.checkbox.checked { background: var(--success); border-color: var(--success); }
.checkbox.checked::after { content: '✓'; color: white; font-size: 12px; font-weight: bold; }
.tag-pill { font-size: 0.75rem; padding: 2px 8px; border-radius: 12px; background: rgba(0,122,255,0.1); color: var(--primary); }
.tag-more { width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
.tag-more:hover { background: rgba(0,0,0,0.08); }

/* 任务列表分区布局 */
#view-tasks { overflow: hidden; height: 100%; min-height: 0; }
#view-tasks.view-container.active { display: block; }
.tasklist-layout { display: grid; grid-template-columns: 210px 1fr; gap: 14px; height: 100%; min-width: 0; }
.tasklist-layout.has-detail { grid-template-columns: 210px 1fr 300px; }
.tasklist-nav { background: var(--glass-card); border-radius: 14px; padding: 12px; position: sticky; top: 20px; height: 100%; display: flex; flex-direction: column; gap: 12px; min-height: 0; overflow-y: auto; }
.tasklist-nav { scrollbar-width: none; }
.tasklist-nav::-webkit-scrollbar { width: 0; height: 0; }
.tasklist-section:first-child .tasklist-item { border-radius: 999px; }
.tasklist-section { display: flex; flex-direction: column; gap: 6px; }
.tasklist-section-header { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
.tasklist-section-title { font-size: 0.8rem; font-weight: 700; color: #555; }
.tasklist-section-toggle {
    border: none;
    background: none;
    padding: 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.8rem;
    font-weight: 700;
    color: #555;
}
.tasklist-section-caret { font-size: 0.8rem; transition: transform 0.2s; }
.tasklist-section-toggle.is-collapsed .tasklist-section-caret { transform: rotate(-90deg); }
.tasklist-section-body.is-collapsed { display: none; }
.tasklist-item { border: none; background: rgba(0,0,0,0.04); border-radius: 10px; padding: 7px 10px; cursor: pointer; text-align: left; font-size: 0.85rem; font-weight: 600; color: #222; transition: 0.2s; }
.tasklist-item:hover { background: rgba(0,0,0,0.08); }
.tasklist-item.active { background: rgba(0,122,255,0.1); color: #0d5bb5; border: 1px solid rgba(0,122,255,0.25); }
.tasklist-item.is-drop-target { background: rgba(0,122,255,0.16); border: 1px dashed rgba(0,122,255,0.4); }
.tasklist-list { display: flex; flex-direction: column; gap: 6px; max-height: 200px; overflow-y: auto; padding-right: 4px; min-height: 0; }
.tasklist-list::-webkit-scrollbar { width: 6px; }
.tasklist-list::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.15); border-radius: 6px; }
.tasklist-list-item { display: flex; align-items: center; gap: 8px; background: rgba(0,0,0,0.04); border-radius: 10px; padding: 8px 10px; cursor: pointer; transition: 0.2s; }
.tasklist-list-item:hover { background: rgba(0,0,0,0.08); }
.tasklist-list-item.active { background: rgba(0,122,255,0.08); border: 1px solid rgba(0,122,255,0.25); }
.tasklist-list-item.is-drop-target { background: rgba(0,122,255,0.16); border: 1px dashed rgba(0,122,255,0.4); }
.tasklist-list-name { flex: 1; font-weight: 600; color: #222; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.tasklist-list-delete { width: 26px; height: 26px; font-size: 0.9rem; }
.tasklist-tag-list { display: flex; flex-direction: column; gap: 5px; max-height: 200px; overflow-y: auto; padding-right: 4px; min-height: 0; }
.tasklist-tag-list#tag-filter-list { max-height: 200px; }
.tasklist-tag-list .nav-item { color: #333; padding: 6px 8px; border-radius: 8px; background: rgba(0,0,0,0.04); opacity: 1; font-size: 0.82rem; }
.tasklist-tag-list .nav-item:hover { background: rgba(0,0,0,0.08); }
.tasklist-tag-list .nav-item.active { background: rgba(0,122,255,0.1); color: #0d5bb5; box-shadow: none; }
.tasklist-filter-panel { display: flex; flex-direction: column; gap: 8px; }
.task-filter-row { display: flex; align-items: center; gap: 8px; }
.task-filter-label { font-size: 0.78rem; font-weight: 600; color: #555; min-width: 44px; }
.task-filter-select {
    flex: 1;
    border: none;
    background: rgba(0,0,0,0.04);
    border-radius: 8px;
    padding: 6px 8px;
    font-size: 0.82rem;
    color: #333;
}
.task-filter-select:focus { background: rgba(0,0,0,0.08); }
.tasklist-section-header .btn-icon:disabled { opacity: 0.4; cursor: not-allowed; }
.tasklist-content { background: var(--glass-card); border-radius: 14px; padding: 12px; min-height: 100%; display: flex; flex-direction: column; min-width: 0; --tasklist-done-height: clamp(180px, 32vh, 320px); }
.tasklist-content-header { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 10px; }
.tasklist-title-group { display: flex; flex-direction: column; gap: 4px; }
.tasklist-content-header.inline-subtitle .tasklist-title-group { flex-direction: row; align-items: baseline; gap: 12px; }
.tasklist-content-header.inline-subtitle .tasklist-subtitle { margin-top: 0; }
.tasklist-content-header.is-compact { margin-bottom: 6px; }
.tasklist-title { font-size: 1rem; font-weight: 700; color: #222; }
.tasklist-subtitle { font-size: 0.85rem; color: #666; margin-top: 4px; }
.tasklist-items { display: flex; flex-direction: column; gap: 16px; flex: 1; min-height: 0; }
.tasklist-panel { background: rgba(0,0,0,0.03); border-radius: 12px; padding: 10px; min-height: 0; display: flex; flex-direction: column; gap: 6px; }
.tasklist-panel--pending { flex: 1 1 auto; min-height: 180px; }
.tasklist-panel--done { flex: 0 0 var(--tasklist-done-height); max-height: var(--tasklist-done-height); margin-top: auto; }
.tasklist-panel--done.is-collapsed { flex: 0 0 auto; max-height: none; }
.tasklist-panel-header { display: flex; align-items: center; justify-content: space-between; gap: 10px; font-weight: 600; color: #333; }
.tasklist-panel-title { font-size: 0.92rem; }
.tasklist-panel-count { font-size: 0.8rem; color: #666; }
.tasklist-panel-body { flex: 1; min-height: 0; }
.tasklist-panel.is-collapsed .tasklist-panel-body { display: none; }
.tasklist-panel-label { display: flex; align-items: center; gap: 6px; }
.tasklist-panel-toggle { background: none; border: none; cursor: pointer; padding: 2px 4px; border-radius: 6px; color: #555; }
.tasklist-panel-toggle:hover { background: rgba(0,0,0,0.08); }
.tasklist-panel-caret { display: inline-block; transition: transform 0.2s ease; }
.tasklist-panel-caret.is-collapsed { transform: rotate(-90deg); }
.task-detail { background: var(--glass-card); border-radius: 14px; padding: 12px; display: none; flex-direction: column; min-height: 0; }
.tasklist-layout.has-detail .task-detail { display: flex; }
.task-detail-header { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 10px; }
.task-detail-title { font-size: 0.95rem; font-weight: 700; color: #222; }
.task-detail-body { display: flex; flex-direction: column; gap: 12px; min-height: 0; flex: 1; }
.task-detail-name { font-size: 1rem; font-weight: 700; color: #222; }
.task-detail-time { font-size: 0.85rem; color: #666; }
.task-detail-notes { display: flex; flex-direction: column; gap: 6px; margin-top: auto; flex: 1; }
.task-detail-textarea { min-height: 360px; resize: vertical; flex: 1; }
.task-board {
    display: grid;
    grid-template-columns: 1.4fr 1fr 1fr;
    gap: 16px;
    min-height: 0;
    flex: 1;
    height: 100%;
    align-items: stretch;
}
.task-column {
    background: rgba(255,255,255,0.6);
    border-radius: 16px;
    padding: 12px;
    display: flex;
    flex-direction: column;
    min-height: 0;
    height: 100%;
    border: 1px solid rgba(255,255,255,0.6);
}
.task-column-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.task-column-header.dim { opacity: 0.7; }
.task-count { font-size: 0.8rem; color: #666; }
.task-section { overflow-y: auto; padding-right: 4px; min-height: 0; flex: 1; }
.task-section::-webkit-scrollbar { width: 6px; }
.task-section::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.15); border-radius: 6px; }
.task-group { padding: 6px 0 4px; }
.task-group-title { font-size: 0.8rem; color: #555; font-weight: 600; margin-bottom: 6px; display: flex; align-items: center; gap: 6px; cursor: pointer; }
.task-group-toggle { width: 14px; text-align: center; opacity: 0.6; }
.task-group-text { flex: 1; }
.task-group.collapsed .task-group-list { display: none; }
.task-group-count { background: rgba(0,0,0,0.08); border-radius: 999px; padding: 1px 6px; font-size: 0.7rem; color: #444; }
.task-empty { opacity: 0.6; font-size: 0.85rem; padding: 6px 2px; }


/* 时间轴 (日视图) */
.timeline-wrapper {
    position: relative;
    height: 1440px;
    margin-top: 10px;
    background-image:
        repeating-linear-gradient(to bottom, rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.1) 1px, transparent 1px, transparent 60px),
        repeating-linear-gradient(to bottom, rgba(0,0,0,0.04) 0px, rgba(0,0,0,0.04) 1px, transparent 1px, transparent 15px);
}
.time-slot { position: absolute; left: 55px; right: 10px; background: rgba(255,255,255,0.9); border-left: 4px solid var(--primary); border-radius: 6px; padding: 5px 8px; font-size: 0.85rem; color: #111; cursor: pointer; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; gap: 8px; align-items: flex-start; z-index: 1; transition: left 0.3s, width 0.3s, box-shadow 0.2s; }
.time-slot:hover { z-index: 20; transform: scale(1.02); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
.time-slot.completed { background: #f0f0f0; border-color: #ccc; opacity: 0.8; }
.time-slot-content {
    display: inline-flex;
    flex-direction: column;
    gap: 6px;
    align-items: flex-start;
    position: relative;
    width: max-content;
    max-width: 100%;
}
.time-slot.completed .task-title-text {
    position: relative;
}
.time-slot.completed .task-title-text::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    top: 50%;
    border-top: 2px solid rgba(0,0,0,0.6);
    pointer-events: none;
}
.time-slot .time-chip { background: rgba(0,0,0,0.05); border-radius: 6px; padding: 2px 6px; font-size: 0.72rem; color: #777; display: inline-block; }
.time-slot .time-chip.small { font-size: 0.7rem; padding: 1px 4px; }
.time-slot .time-slot-tags { font-size: 0.72rem; color: inherit; }
.time-slot .time-tag {
    background: rgba(0,0,0,0.08);
    border-radius: 6px;
    padding: 1px 4px;
    display: inline-block;
    font-weight: 600;
}
.time-slot .task-title-text { color: #111; }
.time-ruler { position: absolute; left: 0; width: 45px; height: 100%; border-right: 1px solid rgba(0,0,0,0.1); }
.hour-mark { height: 60px; border-top: 1px dashed rgba(0,0,0,0.1); text-align: right; padding-right: 8px; font-size: 0.75rem; color: #888; }
.resize-handle { position: absolute; left: 0; right: 0; height: 10px; cursor: ns-resize; z-index: 10; }
.resize-handle.top { top: 0; } .resize-handle.bottom { bottom: 0; }
.resize-handle:hover { background: rgba(0,0,0,0.1); }
#ghost-line { position: absolute; left: 0; right: 0; height: 1px; border-top: 2px dashed var(--danger); z-index: 50; display: none; pointer-events: none; }
#ghost-line::after { content: attr(data-time); position: absolute; left: 0; top: -20px; background: var(--danger); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }

/* 修复紧凑型任务块显示 (Problem 4 fix) */
.time-slot.is-compact {
    padding: 0 4px !important;
    align-items: center;
    overflow: hidden !important; 
    white-space: nowrap;
}
.time-slot.is-compact .task-title-text {
    /* 移除之前 app.js 中导致文字跑出去的 absolute 定位 */
    position: static !important; 
    background: transparent !important;
    box-shadow: none !important;
    margin-left: 4px;
    font-size: 0.75rem;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
    color: inherit;
    flex: 1;
}
.time-slot.is-compact .checkbox { transform: scale(0.6); margin: 0; }

/* 日历设置面板 (Problem 3 fix) */
#cal-settings-container { position: relative; display: inline-block; }
#cal-settings-panel {
    display: none; /* 默认隐藏 */
    position: absolute; right: 0; top: 100%; margin-top: 5px;
    background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
    border: 1px solid rgba(0,0,0,0.1); border-radius: 8px;
    padding: 10px; width: 160px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    z-index: 100; text-align: left;
}
#cal-settings-panel.show { display: block; }
.cal-setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; cursor: pointer; padding: 2px 0; }
.toggle-switch { width: 36px; height: 20px; background: #ddd; border-radius: 10px; position: relative; transition: 0.3s; }
.toggle-switch::after { content:''; position:absolute; left:2px; top:2px; width:16px; height:16px; background:white; border-radius:50%; transition:0.3s; box-shadow:0 1px 3px rgba(0,0,0,0.2); }
.toggle-switch.active { background: var(--success); }
.toggle-switch.active::after { left: 18px; }

/* 日历头部按钮 (Problem 1 fix) */
.btn-today-jump { 
    padding: 2px 8px !important; 
    height: 28px; 
    line-height: 1; 
    white-space: nowrap; 
    min-width: auto;
}

/* 周视图 */
#cal-week-view { height: 100%; display: none; flex-direction: column; min-height: 0; }
.week-header-row {
    display: flex;
    border: 1px solid rgba(0,0,0,0.06);
    border-bottom: none;
    border-radius: 12px 12px 0 0;
    background: rgba(255,255,255,0.25);
    overflow: hidden;
}
.week-header-time {
    flex-shrink: 0;
    width: 55px;
    border-right: 1px solid rgba(0,0,0,0.1);
    background: rgba(255,255,255,0.35);
}
.week-header-scroll { flex: 1; overflow: hidden; }
.week-header-days {
    display: grid;
    grid-template-columns: repeat(7, minmax(120px, 1fr));
    min-width: 840px;
}
.week-header-cell { text-align: center; padding: 8px 6px; border-right: 1px solid rgba(0,0,0,0.06); }
.week-header-cell:last-child { border-right: none; }
.week-header-cell .lunar-text { display: block; margin-top: 2px; }
.week-allday-list { margin-top: 6px; display: flex; flex-direction: column; gap: 4px; }
.week-allday-item {
    background: rgba(255,255,255,0.9);
    border-radius: 6px;
    padding: 2px 6px;
    font-size: 0.72rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    cursor: pointer;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: #111;
}
.week-allday-item.completed { opacity: 0.6; text-decoration: line-through; }
.week-timeline {
    position: relative;
    display: flex;
    flex: 1;
    min-height: 0;
    overflow: auto;
    border: 1px solid rgba(0,0,0,0.06);
    border-top: none;
    border-radius: 0 0 12px 12px;
    background: rgba(255,255,255,0.1);
}
.week-time-ruler {
    flex-shrink: 0;
    width: 55px;
    border-right: 1px solid rgba(0,0,0,0.1);
    background: rgba(255,255,255,0.35);
    position: sticky;
    left: 0;
    top: 0;
    z-index: 2;
    height: 1440px;
}
.week-days {
    position: relative;
    flex: 1;
    display: flex;
    min-width: 840px;
    height: 1440px;
    background-image:
        repeating-linear-gradient(to bottom, rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.1) 1px, transparent 1px, transparent 60px),
        repeating-linear-gradient(to bottom, rgba(0,0,0,0.04) 0px, rgba(0,0,0,0.04) 1px, transparent 1px, transparent 15px);
}
.week-day-column {
    position: relative;
    flex: 1;
    min-width: 120px;
    border-right: 1px solid rgba(0,0,0,0.06);
}
/* 移动端显示所有日期列的右侧边框，确保定位虚线完整 */
@media (max-width: 768px) {
    .week-day-column { border-right: 1px solid rgba(0,0,0,0.06); }
}

/* 桌面端保持最后一列无边框 */
@media (min-width: 769px) {
    .week-day-column:last-child { border-right: none; }
}
.week-time-slot {
    position: absolute;
    background: rgba(255,255,255,0.92);
    border-left: 4px solid var(--primary);
    border-radius: 6px;
    padding: 4px 6px;
    font-size: 0.75rem;
    color: #111;
    cursor: pointer;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    display: flex;
    flex-direction: column;
    gap: 6px;
    align-items: flex-start;
}
.week-time-slot.completed { background: #f0f0f0; border-color: #ccc; opacity: 0.8; }
.week-slot-content {
    display: inline-flex;
    flex-direction: column;
    gap: 6px;
    align-items: flex-start;
    position: relative;
    width: max-content;
    max-width: 100%;
}
.week-time-slot.completed .task-title-text {
    position: relative;
}
.week-time-slot.completed .task-title-text::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    top: 50%;
    border-top: 2px solid rgba(0,0,0,0.6);
    pointer-events: none;
}
.week-time-slot .time-chip { background: rgba(0,0,0,0.06); border-radius: 6px; padding: 1px 4px; font-size: 0.68rem; color: #777; display: inline-block; }
.week-time-slot .time-chip.small { font-size: 0.65rem; padding: 0 4px; }
.week-time-slot .time-slot-tags { font-size: 0.68rem; color: inherit; }
.week-time-slot .week-inline-tag {
    font-size: 0.65rem;
    color: inherit;
    opacity: 0.9;
    background: rgba(0,0,0,0.08);
    border-radius: 6px;
    padding: 0 4px;
    display: inline-block;
    font-weight: 600;
}
.week-time-slot .task-title-text { color: #111; }
.week-time-slot.is-compact { padding: 0 4px; align-items: center; white-space: nowrap; flex-direction: row; }
.week-time-slot.is-compact .task-title-text { font-size: 0.7rem; overflow: hidden; text-overflow: ellipsis; }
.stats-metrics { display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 12px; margin-bottom: 20px; }
.stats-metric-card { background: rgba(255,255,255,0.9); border: 1px solid rgba(0,0,0,0.05); border-radius: 12px; padding: 14px 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
.stats-metric-title { font-size: 0.75rem; color: #666; }
.stats-metric-value { font-size: 1.6rem; font-weight: 700; color: #222; margin-top: 6px; }
.heatmap-grid { display: grid; grid-auto-flow: column; grid-template-rows: repeat(7, 12px); gap: 4px; padding: 10px 0; }
.heatmap-cell { width: 12px; height: 12px; border-radius: 3px; background: rgba(0,0,0,0.08); }
.heatmap-cell.empty { background: transparent; }
.heatmap-cell.level-1 { background: rgba(0,122,255,0.25); }
.heatmap-cell.level-2 { background: rgba(0,122,255,0.45); }
.heatmap-cell.level-3 { background: rgba(0,122,255,0.65); }
.heatmap-cell.level-4 { background: rgba(0,122,255,0.85); }
.heatmap-legend { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; color: #666; }

/* 月视图 */
.month-grid { display: grid; grid-template-columns: repeat(7, 1fr); grid-auto-rows: 140px; gap: 2px; background: rgba(0,0,0,0.05); border: 1px solid rgba(255,255,255,0.3); border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
.month-cell {
    background: rgba(255,255,255,0.95);
    padding: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    border-radius: 4px;
    position: relative;
    user-select: none;
}.month-cell:hover {
    background: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    z-index: 10;
}.month-cell:active {
    transform: translateY(0);
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}/* 拖拽时的样式 */
.month-cell.drag-over {
    background: linear-gradient(135deg, rgba(0,122,255,0.15) 0%, rgba(0,122,255,0.05) 100%);
    border: 2px dashed rgba(0,122,255,0.5);
    transform: scale(1.02);
    z-index: 15;
}
.month-cell.today {
    background: linear-gradient(135deg, rgba(0,122,255,0.12) 0%, rgba(0,122,255,0.03) 100%);
    border: 1px solid rgba(0,122,255,0.4);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.6);
}
.month-cell.holiday-off {
    background: linear-gradient(135deg, rgba(52,199,89,0.12) 0%, rgba(52,199,89,0.03) 100%);
    border: 1px solid rgba(52,199,89,0.3);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.6);
}.month-cell.holiday-work {
    background: linear-gradient(135deg, rgba(255,59,48,0.12) 0%, rgba(255,59,48,0.03) 100%);
    border: 1px solid rgba(255,59,48,0.3);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.6);
}
.month-cell.empty {
    background: rgba(255,255,255,0.7);
    cursor: default;
    pointer-events: none;
}
.month-cell.today::before {
    content: attr(data-task-count);
    position: absolute;
    top: 8px;
    right: 8px;
    min-width: 18px;
    height: 18px;
    background: var(--danger);
    color: white;
    font-size: 11px;
    font-weight: bold;
    border-radius: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 4px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    z-index: 5;
}
.month-cell-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
    padding-bottom: 4px;
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.month-date-container {
    display: flex;
    align-items: center;
    gap: 6px;
    flex: 1;
}

.month-date-number {
    font-weight: bold;
    font-size: 0.8rem;
    color: #333;
}

/* 美化节日标记样式 */
.holiday-tag {
    font-size: 0.65rem;
    padding: 1px 5px;
    border-radius: 4px;
    font-weight: 500;
    line-height: 1.3;
    display: inline-block;
    white-space: nowrap;
    /* 移除最大宽度限制 */
}

.holiday-tag.off {
    background: rgba(52, 199, 89, 0.1);
    color: var(--success);
}

.holiday-tag.work {
    background: rgba(255, 59, 48, 0.1);
    color: var(--danger);
}
.month-task-pill {
    --month-pill-h: clamp(18px, 2.5vh, 24px);
    font-size: clamp(11px, calc(var(--month-pill-h) * 0.55), 13px);
    height: var(--month-pill-h);
    padding: 0 8px;
    border-radius: 12px;
    color: white;
    margin-bottom: 3px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: flex;
    align-items: center;
    border: none;
    position: relative;
    box-shadow: 0 1px 3px rgba(0,0,0,0.15);
    transition: all 0.2s ease;
    opacity: 0.95;
}.month-task-pill:hover {
    transform: translateX(3px) translateY(-1px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    opacity: 1;
    z-index: 20;
}
.month-task-pill.completed {
    opacity: 0.7;
    filter: grayscale(30%);
}
.month-task-pill .month-time {
    font-size: 0.85em;
    color: rgba(255,255,255,0.8);
    margin-right: 6px;
    font-weight: 500;
}
.month-task-pill.completed::after {
    content: '✓';
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.2em;
    font-weight: bold;
    color: rgba(255,255,255,0.9);
    pointer-events: none;
}
.month-task-pill .month-tag {
    color: rgba(255,255,255,0.9);
    margin-left: 6px;
    font-weight: 600;
    font-size: 0.9em;
    background: rgba(255,255,255,0.2);
    padding: 0 4px;
    border-radius: 8px;
    backdrop-filter: blur(10px);
}
.month-tag {
    font-size: 0.7rem;
    padding: 1px 6px;
    border-radius: 8px;
    background: rgba(0,0,0,0.08);
    color: #333;
    display: inline-block;
}
.lunar-text {
    font-size: 0.7rem;
    color: #888;
    margin-top: 2px;
    font-family: 'Microsoft YaHei', sans-serif;
}

/* 月视图星期标题优化 */
#cal-month-view > div:first-child {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    text-align: center;
    margin-bottom: 12px;
    gap: 2px;
    padding: 0 2px;
}
#cal-month-view > div:first-child > div {
    font-weight: 600;
    color: #666;
    font-size: 0.9rem;
    padding: 8px 0;
    border-radius: 8px;
    background: rgba(255,255,255,0.8);
    border: 1px solid rgba(255,255,255,0.3);
}
#cal-month-view > div:first-child > div:nth-child(1),
#cal-month-view > div:first-child > div:nth-child(7) {
    color: var(--danger);
    background: rgba(255,59,48,0.05);
}

/* 四象限 */
.matrix-grid { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 15px; height: 100%; }
.quadrant { background: var(--glass-card); border-radius: 16px; padding: 15px; overflow-y: auto; position: relative; transition: 0.2s; }
.quadrant.drag-over { background: rgba(255, 255, 255, 0.8); box-shadow: inset 0 0 20px rgba(0,122,255,0.1); transform: scale(1.01); border: 2px dashed var(--primary); }

/* 统计卡片 */
.stats-card { background: var(--glass-card); border-radius: 16px; padding: 20px; margin-bottom: 20px; }
.settings-toggle { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; }
.settings-label { display: inline-flex; align-items: center; gap: 6px; }
.settings-toggle .help-icon { width: 18px; height: 18px; border-radius: 50%; border: 1px solid rgba(0,0,0,0.2); color: #666; display: inline-flex; align-items: center; justify-content: center; font-size: 0.7rem; cursor: help; margin-left: 6px; }
.help-icon { width: 18px; height: 18px; border-radius: 50%; border: 1px solid rgba(0,0,0,0.2); color: #666; display: inline-flex; align-items: center; justify-content: center; font-size: 0.7rem; cursor: help; }
.mobile-only { display: none; }

.settings-layout { display: grid; grid-template-columns: 220px 1fr; gap: 20px; align-items: stretch; }
.settings-nav { background: var(--glass-card); border-radius: 16px; padding: 16px; position: sticky; top: 20px; }
.settings-select-mobile { display: none; width: 100%; padding: 10px 12px; border: 1px solid rgba(0,0,0,0.1); border-radius: 10px; background: white; font-size: 0.92rem; color: #333; cursor: pointer; margin-bottom: 10px; }
.settings-nav-title { font-size: 0.85rem; color: #666; margin-bottom: 10px; }
.settings-nav a { display: block; padding: 8px 10px; border-radius: 10px; color: #333; text-decoration: none; font-size: 0.92rem; }
.settings-nav a:hover { background: rgba(0,0,0,0.06); }
.settings-nav a.active { background: rgba(0,0,0,0.08); font-weight: 600; }
.settings-section { scroll-margin-top: 20px; }
#view-settings { height: auto; }
#view-settings .settings-layout { height: auto; min-height: auto; }
/* 桌面端设置 */
@media (min-width: 901px) {
    #view-settings .settings-nav,
    #view-settings .settings-content { height: 100%; }
    #view-settings .settings-section { min-height: 100%; }
}

@media (max-width: 900px) {
    .settings-layout { grid-template-columns: 1fr; grid-template-rows: auto auto; height: auto; }
    .settings-nav { position: sticky; top: 0; z-index: 100; display: block; padding: 10px; height: auto; background: white; border-bottom: 1px solid rgba(0,0,0,0.1); }
    .settings-select-mobile { display: block; }
    .settings-nav a { display: none; }
    #view-settings .settings-content { height: auto; overflow-y: auto; }
    #view-settings .settings-section { min-height: auto; }
    .settings-nav-title { display: none; }
}

/* 为移动设备优化滚动条 */
@media (max-width: 900px) {
    .settings-nav::-webkit-scrollbar {
        height: 4px;
    }
    
    .settings-nav::-webkit-scrollbar-thumb {
        background: rgba(0,0,0,0.2);
        border-radius: 2px;
    }
    
    .settings-nav::-webkit-scrollbar-track {
        background: rgba(0,0,0,0.05);
    }
    
    /* 确保设置页面在移动端完整显示 */
    #view-settings.view-container.active {
        overflow-y: auto;
        height: auto;
        min-height: auto;
    }
    
    #view-settings .settings-content {
        height: auto;
        min-height: auto;
        overflow-y: visible;
    }
}

.checklist-layout { display: grid; grid-template-columns: 220px 1fr; gap: 20px; height: 100%; min-width: 0; overflow: hidden; }
.checklist-layout.has-detail { grid-template-columns: 220px 1fr 320px; }
.checklist-detail { display: none; }
.checklist-layout.has-detail .checklist-detail { display: flex; }
.checklist-nav { background: var(--glass-card); border-radius: 16px; padding: 16px; position: sticky; top: 20px; height: 100%; display: flex; flex-direction: column; gap: 12px; }
.checklist-nav-header { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
.checklist-nav-title { font-size: 0.95rem; font-weight: 700; }
.checklist-nav-subtitle { font-size: 0.8rem; color: #666; }
.checklist-nav-list { display: flex; flex-direction: column; gap: 8px; overflow-y: auto; position: relative; }
.checklist-nav-item { padding: 10px 12px; border-radius: 12px; background: rgba(0,0,0,0.04); display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.2s; }
.checklist-nav-item:hover { background: rgba(0,0,0,0.08); }
.checklist-nav-item.active { background: rgba(0,122,255,0.08); border: 1px solid rgba(0,122,255,0.25); }
.checklist-nav-name { font-weight: 600; color: #222; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.checklist-nav-owner { font-size: 0.75rem; color: #777; margin-top: 4px; }
.checklist-nav-actions { display: flex; align-items: center; gap: 6px; }
.checklist-nav-actions { position: relative; }
.checklist-menu { position: fixed; background: white; border: 1px solid rgba(0,0,0,0.08); border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.12); min-width: 140px; z-index: 1200; overflow: hidden; }
.checklist-menu-item { padding: 8px 12px; cursor: pointer; font-size: 0.9rem; }
.checklist-menu-item:hover { background: rgba(0,0,0,0.05); }
.checklist-menu-danger { color: #c62828; }
.checklist-content { background: var(--glass-card); border-radius: 16px; padding: 16px; min-height: 100%; display: flex; flex-direction: column; min-width: 0; overflow: hidden; }
.checklist-content-header { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 14px; }
.checklist-content-title { font-size: 1.1rem; font-weight: 700; color: #222; }
.checklist-content-subtitle { font-size: 0.85rem; color: #666; }
.checklist-items { display: flex; gap: 12px; flex: 1; width: 100%; min-width: 0; overflow-x: auto; padding-bottom: 6px; scrollbar-width: thin; scrollbar-color: rgba(0,0,0,0.25) transparent; }
.checklist-items::-webkit-scrollbar { height: 8px; }
.checklist-items::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 8px; }
.checklist-column { min-width: 260px; flex: 1 1 280px; background: rgba(0,0,0,0.03); border-radius: 14px; padding: 10px; display: flex; flex-direction: column; gap: 8px; }
.checklist-column.is-drop-target { background: rgba(0,122,255,0.08); border: 1px solid rgba(0,122,255,0.25); }
.checklist-column-header { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
.checklist-column-title {
    font-weight: 700;
    font-size: clamp(0.78rem, 1.1vw, 0.95rem);
    color: #222;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
}
.checklist-column-progress {
    font-size: 0.75rem;
    color: #666;
    white-space: nowrap;
    flex-shrink: 0;
}
.checklist-column-actions { display: flex; gap: 6px; position: relative; }
.checklist-column-menu { top: 32px; right: 0; min-width: 110px; }
.checklist-column-list { display: flex; flex-direction: column; gap: 8px; flex: 1; }
.checklist-item-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; padding: 10px 44px 10px 12px; border-radius: 12px; background: rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.05); }
.checklist-item-row.dragging { opacity: 0.6; }
.checklist-item-row.completed { opacity: 0.7; }
.checklist-item-main { display: flex; align-items: center; gap: 10px; flex: 1 1 0; min-width: 0; }
.checklist-item-input { flex: 1 1 0; min-width: 0; border: none; background: transparent; outline: none; font-size: 0.95rem; padding: 6px 8px; border-radius: 8px; }
.checklist-item-input:focus { background: rgba(0,0,0,0.04); }
.checklist-completed-by { font-size: 0.8rem; color: #666; margin-left: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.checklist-item-row .btn-icon { flex-shrink: 0; }
.checklist-item-card { display: flex; flex-direction: column; gap: 6px; position: relative; }
.checklist-item-card.is-active { outline: 2px solid rgba(0,122,255,0.2); border-radius: 12px; }
.checklist-subtask-list { display: flex; flex-direction: column; gap: 4px; margin-left: 26px; }
.checklist-subtask {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.8rem;
    color: #555;
    cursor: pointer;
    padding: 2px 4px;
    border-radius: 6px;
}
.checklist-subtask:hover { background: rgba(0,0,0,0.04); }
.checklist-subtask-box {
    width: 12px;
    height: 12px;
    border: 1.5px solid #bbb;
    border-radius: 3px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    background: white;
    cursor: pointer;
}
.checklist-subtask.completed { color: #888; text-decoration: line-through; }
.checklist-subtask.completed .checklist-subtask-box {
    background: var(--success);
    border-color: var(--success);
    color: white;
    font-size: 9px;
    font-weight: bold;
}
.checklist-subtask.completed .checklist-subtask-box::after { content: '✓'; }
.checklist-subtask-title { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: pointer; }
.checklist-subtask-item { display: flex; align-items: flex-start; gap: 8px; margin-bottom: 8px; }
.checklist-subtask-input { flex: 1; margin: 0; padding: 6px; }
.checklist-subtask-remove { cursor: pointer; margin-left: 6px; }
.subtask-fields { display: flex; flex-direction: column; gap: 6px; flex: 1; min-width: 0; }
.subtask-title-input { margin: 0; padding: 6px; width: 100%; }
.subtask-note-row { display: flex; align-items: center; gap: 8px; }
.subtask-note-label {
    font-size: 0.75rem;
    color: #666;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 45%;
}
.subtask-note-input { margin: 0; padding: 6px; flex: 1; }
.subtask-remove { cursor: pointer; margin-left: 8px; }
.subtask-notes-btn {
    background: none;
    border: none;
    color: var(--primary);
    font-size: 1rem;
    cursor: pointer;
    padding: 4px;
    margin-left: 4px;
    border-radius: 4px;
    transition: all 0.2s ease;
}
.subtask-notes-btn:hover {
    background: rgba(0,0,0,0.05);
    color: var(--primary-dark);
    transform: scale(1.1);
}
.checklist-empty { color: #777; font-size: 0.9rem; padding: 12px; background: rgba(0,0,0,0.03); border-radius: 12px; text-align: center; }
.btn-ghost { background: none; border: none; color: #555; cursor: pointer; padding: 4px 6px; border-radius: 8px; }
.btn-ghost:hover { background: rgba(0,0,0,0.08); }

/* 备注弹窗样式优化 */
#task-notes-modal-overlay {
    animation: fadeIn 0.3s ease;
}

#task-notes-modal {
    animation: slideIn 0.3s ease;
}

#task-notes-view {
    font-size: 0.9rem;
    color: #333;
    background: #f9f9f9;
}

#task-notes-view:empty::before {
    content: '暂无备注';
    color: #999;
    font-style: italic;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideIn {
    from { transform: translateY(-20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
.checklist-content .btn-icon { border: 1px solid rgba(0,0,0,0.1); }
.checklist-content .btn-icon:disabled { opacity: 0.4; cursor: not-allowed; }
.share-user-row { padding: 8px 10px; border-radius: 10px; background: rgba(0,0,0,0.04); margin-bottom: 6px; }
.share-perms { display: flex; gap: 10px; font-size: 0.85rem; color: #555; }
.share-form { display: flex; gap: 8px; align-items: stretch; }
.share-input { margin-bottom: 0; }
.share-action { min-width: 68px; height: 38px; padding: 0 14px; border-radius: 10px; }
.column-delete-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 16px;
    flex-wrap: wrap;
}

@media (max-width: 900px) {
    .checklist-layout { grid-template-columns: 1fr; grid-template-rows: auto 1fr; height: 100%; }
    .checklist-layout.has-detail { grid-template-columns: 1fr; grid-template-rows: auto 1fr auto; }
    .checklist-nav { position: static; flex-direction: column; }
    .checklist-content { min-height: 60vh; }
}

/* Modal */
#modal-overlay, #admin-modal, #export-modal-overlay, #checklist-column-delete-modal { position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; }
#checklist-share-modal { position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; }
.modal-box { background: rgba(255,255,255,0.95); padding: 25px; border-radius: 20px; width: 95%; max-width: 450px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); max-height: 85vh; overflow-y: auto; }
.modal-box { -ms-overflow-style: none; scrollbar-width: none; }
.modal-box::-webkit-scrollbar { width: 0; height: 0; }
.task-modal.is-collapsed .task-modal-details { display: none; }
.task-modal.is-collapsed .task-modal-save { display: none; }
.form-input { width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid #e0e0e0; background: white; font-size: 0.95rem; margin-bottom: 15px; }
.form-label { font-size: 0.8rem; color: #666; margin-bottom: 4px; display: block; font-weight: 600; }
.subtask-item { display: flex; align-items: flex-start; gap: 8px; margin-bottom: 8px; }

/* Toast */
#toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 2000; pointer-events: none; }
.toast { background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 20px; margin-bottom: 10px; backdrop-filter: blur(10px); opacity: 0; transform: translateY(-20px); transition: 0.4s; pointer-events: auto; }
.toast.show { opacity: 1; transform: translateY(0); }
.toast.undo { display: flex; align-items: center; gap: 10px; }
.toast.undo button { background: white; color: #333; border: none; border-radius: 12px; padding: 4px 10px; font-size: 0.75rem; cursor: pointer; }
.toast.undo button:hover { opacity: 0.9; }

/* 多选模式样式 (moved from app.js) */
.task-card.selection-mode { transition: transform 0.2s; }
.task-card.selection-mode .checkbox { border-color: #ccc; background: white; pointer-events: none; }
.task-card.selection-mode .checkbox::after { content: ''; } 
.task-card.selection-mode.selected { background: #eef6ff; border-color: var(--primary) !important; transform: scale(0.98); }
.task-card.selection-mode.selected .checkbox { background: var(--primary); border-color: var(--primary); }
.task-card.selection-mode.selected .checkbox::after { content: '✓'; color: white; font-size:12px; }

/* 底部操作栏 */
#selection-bar {
    position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.9);
    color: #333; padding: 12px 25px; border-radius: 40px; 
    display: flex; gap: 15px; align-items: center; z-index: 2000; 
    backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    box-shadow: 0 10px 40px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.5);
    animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); white-space: nowrap;
}
#selection-bar .btn-secondary { background: rgba(0,0,0,0.08); color: #333; }
#selection-bar .btn-secondary:hover { background: rgba(0,0,0,0.15); }
@keyframes slideUp { from { transform: translate(-50%, 100%); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }

/* 移动端适配 */
@media (max-width: 768px) {
    body { flex-direction: column; }
    #sidebar { display: none; }
    #mobile-tabbar { display: flex; }
    #main { padding-bottom: calc(var(--tab-height) + env(safe-area-inset-bottom, 0px) + 12px); }
    .toolbar { padding: 0 15px; height: 56px; gap: 10px; }
    .toolbar-search { flex: 1; min-width: 0; }
    .search-bar { width: auto; flex: 1; }
    .search-bar:focus-within { width: auto; }
    /* 在日历视图下隐藏搜索栏 */
    #view-calendar.active ~ .toolbar .toolbar-search:has(~ #calendar-controls) .search-bar { display: none; }
    
    /* 手机视图下将"共同空闲时间"缩写为"闲时" */
    #btn-free-time { position: relative; }
    @media (max-width: 768px) {
        #btn-free-time { font-size: 0; padding: 10px; }
        #btn-free-time::after { 
            content: "闲"; 
            font-size: 0.75rem; 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
        }
    }
    .view-container { padding-bottom: calc(var(--tab-height) + env(safe-area-inset-bottom, 0px) + 24px); }
    .matrix-grid { grid-template-columns: 1fr; grid-template-rows: repeat(4, 1fr); gap: 10px; }
    .matrix-grid { height: auto; }
    .quadrant { min-height: 180px; }
    .desktop-only { display: none !important; }
    #view-tasks { overflow-y: auto; overflow-x: hidden; height: auto; padding-left: 0; padding-right: 0; }
    #view-tasks.view-container { padding-left: 12px; padding-right: 12px; }
    .tasklist-layout { grid-template-columns: 1fr; grid-template-rows: auto 1fr; height: auto; gap: 10px; }
    .tasklist-content { --tasklist-done-height: clamp(160px, 30vh, 240px); }
    .tasklist-layout.has-detail { grid-template-columns: 1fr; grid-template-rows: auto 1fr auto; }
    .tasklist-nav { position: static; max-height: 42vh; overflow-y: auto; }
    .tasklist-list { max-height: none; }
    .tasklist-tag-list { max-height: none; }
    #view-stats .stats-card { overflow-x: auto; }
    .heatmap-grid { grid-template-rows: repeat(7, 10px); gap: 3px; width: max-content; min-width: 100%; }
    .heatmap-cell { width: 10px; height: 10px; border-radius: 2px; }
    .heatmap-legend { gap: 4px; font-size: 0.7rem; }
    /* 移动端周视图优化 */
    .week-header-time { width: 45px; }
    .week-header-days { grid-template-columns: repeat(7, minmax(100px, 1fr)); }
    .week-time-ruler { width: 45px; }
    .week-days { min-width: auto; /* 改为auto以适应内容宽度 */ }
    /* 确保周视图背景虚线能完整显示到最后一列 */
    .week-day-column { flex-shrink: 0; /* 防止列被压缩 */ }
    .stats-metrics { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    #selection-bar { bottom: 90px; }
    .mobile-only { display: block; }
    #mobile-tabbar .tab-item[data-view="recycle"] { display: none; }
    .month-grid { grid-auto-rows: 90px; }
    .month-cell { height: 90px; }
    .checklist-layout { grid-template-columns: 1fr; grid-template-rows: auto 1fr; height: 100%; }
    .checklist-layout.has-detail { grid-template-columns: 1fr; grid-template-rows: auto 1fr auto; }
}

/* Local Admin 特有 */
#admin-user-list { max-height: 200px; overflow-y: auto; margin-top: 10px; border: 1px solid #eee; border-radius: 8px; }


/* Pomodoro view */
.pomodoro-swipe {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 20px;
    align-items: stretch;
}
.pomodoro-screen { display: flex; align-items: stretch; }
.pomodoro-screen > * { width: 100%; }
.pomodoro-swipe-dots {
    display: none;
    align-items: center;
    justify-content: center;
    gap: 6px;
    margin-top: 12px;
}
.pomodoro-swipe-dot {
    width: 6px;
    height: 6px;
    border-radius: 999px;
    background: rgba(0,0,0,0.2);
    transition: 0.2s;
}
.pomodoro-swipe-dot.active {
    width: 18px;
    background: rgba(0,0,0,0.5);
}
.pomodoro-panel { text-align: center; padding: 26px 18px; overflow: hidden; box-sizing: border-box; height: 100%; position: relative; }
.pomodoro-mode { font-size: 0.9rem; letter-spacing: 1px; color: #666; margin-bottom: 6px; }
.pomodoro-task-title { font-size: 1rem; font-weight: 700; color: #222; cursor: pointer; display: block; width: 100%; padding: 8px 12px; margin: 0 auto; border-radius: 10px; text-align: center; }
.pomodoro-task-title:hover { background: rgba(0,0,0,0.05); }
.pomodoro-task-hint { font-size: 0.75rem; color: #888; margin-top: 2px; margin-bottom: 6px; }
.pomodoro-progress { position: relative; width: min(400px, 100%); height: min(400px, 100%); max-width: 100%; margin: 12px auto 18px; }
.pomodoro-progress svg { width: 100%; height: 100%; transform: rotate(90deg); }
.pomodoro-ticks line { stroke: rgba(0,0,0,0.18); stroke-width: 2; stroke-linecap: round; }
.pomodoro-progress.break .pomodoro-ticks line { stroke: rgba(42,157,143,0.5); }
.pomodoro-progress.work .pomodoro-ticks line { stroke: rgba(228,87,46,0.5); }
.pomodoro-ring-bg { fill: none; stroke: rgba(0,0,0,0.08); stroke-width: 12; }
.pomodoro-ring { fill: none; stroke: #e4572e; stroke-width: 12; stroke-linecap: round; transition: stroke-dashoffset 0.05s linear, stroke 0.3s ease; transform: scaleX(-1); transform-origin: 50% 50%; }
.pomodoro-progress.work .pomodoro-ring { stroke: #e4572e; }
.pomodoro-progress.break .pomodoro-ring { stroke: #2a9d8f; }
.pomodoro-action-btn {
    position: absolute;
    left: 50%;
    top: 44%;
    transform: translate(-50%, -50%);
    width: 54px;
    height: 54px;
    border-radius: 50%;
    border: none;
    background: rgba(255,255,255,0.9);
    box-shadow: 0 8px 18px rgba(0,0,0,0.12);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.pomodoro-action-btn:active { transform: translate(-50%, -50%) scale(0.96); }
.pomodoro-action-icon { width: 0; height: 0; border-top: 10px solid transparent; border-bottom: 10px solid transparent; border-left: 16px solid #e4572e; margin-left: 4px; }
.pomodoro-action-btn.is-running .pomodoro-action-icon {
    width: 16px;
    height: 20px;
    border: none;
    margin-left: 0;
    position: relative;
}
.pomodoro-action-btn.is-running .pomodoro-action-icon::before,
.pomodoro-action-btn.is-running .pomodoro-action-icon::after {
    content: '';
    position: absolute;
    top: 0;
    width: 5px;
    height: 20px;
    background: #2a9d8f;
    border-radius: 2px;
}
.pomodoro-action-btn.is-running .pomodoro-action-icon::before { left: 0; }
.pomodoro-action-btn.is-running .pomodoro-action-icon::after { right: 0; }
.pomodoro-timer { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 1.9rem; font-weight: 700; color: var(--primary); transition: color 0.3s ease; transform: translateY(65px); pointer-events: none; }
.pomodoro-timer span { pointer-events: auto; cursor: pointer; }
.pomodoro-timer.work { color: #e4572e; }
.pomodoro-timer.break { color: #2a9d8f; }
.pomodoro-cycle { font-size: 0.85rem; color: #666; margin-bottom: 10px; }
.pomodoro-controls { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin: 10px 0 6px; }
.pomodoro-toggle { margin-top: 10px; }
.pomodoro-setting-row { display: grid; grid-template-columns: 1fr 120px; gap: 10px; align-items: center; margin-bottom: 10px; font-size: 0.85rem; color: #555; }
.pomodoro-setting-input { padding: 8px 10px; }
.pomodoro-settings .pomodoro-setting-row { justify-items: start; text-align: left; }
.pomodoro-settings .pomodoro-setting-row .pomodoro-setting-input { justify-self: center; text-align: center; }
.pomodoro-settings .pomodoro-toggle {
    display: grid;
    grid-template-columns: 1fr 120px;
    align-items: center;
    text-align: left;
}
.pomodoro-settings .pomodoro-toggle .toggle-switch { justify-self: center; }
#pomodoro-settings-overlay {
    position: fixed;
    inset: 0;
    z-index: 1200;
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(6px);
    display: none;
    align-items: center;
    justify-content: center;
}
#pomodoro-settings-overlay.show { display: flex; }
.pomodoro-setting-actions { display: flex; justify-content: center; margin-top: 6px; }
.pomodoro-stat-row { display: flex; justify-content: space-between; font-size: 0.9rem; color: #555; padding: 6px 0; border-bottom: 1px dashed rgba(0,0,0,0.08); }
.pomodoro-stat-row:last-child { border-bottom: none; }
.pomodoro-stats-split { display: grid; grid-template-rows: 1fr 1fr; gap: 12px; }
.pomodoro-stats-split .stats-metric-title { text-align: left; }
.pomodoro-stat-mini {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
    gap: 6px;
    padding: 10px 12px;
    border-radius: 10px;
    background: rgba(255,255,255,0.92);
    border: 1px solid rgba(0,0,0,0.05);
    box-shadow: 0 1px 6px rgba(0,0,0,0.04);
}
.pomodoro-stat-mini .stats-metric-value {
    font-size: 2.4rem;
    font-weight: 700;
    align-self: center;
    text-align: center;
    line-height: 1.1;
    margin-top: 4px;
}
.pomodoro-history-item { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px dashed rgba(0,0,0,0.08); font-size: 0.85rem; color: #555; }
.pomodoro-history-item:last-child { border-bottom: none; }
.pomodoro-history-date { font-size: 0.75rem; font-weight: 600; color: #666; margin-top: 8px; margin-bottom: 4px; }
.pomodoro-history-date {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    user-select: none;
}
.pomodoro-history-date::after {
    content: '-';
    font-size: 0.9rem;
    color: #999;
    margin-left: 8px;
}
.pomodoro-history-date.is-collapsed::after {
    content: '+';
}
.pomodoro-history-group[data-collapsed="true"] {
    display: none;
}
.pomodoro-pill { display: inline-block; padding: 2px 6px; border-radius: 999px; background: rgba(255,99,71,0.12); color: #d35400; font-size: 0.7rem; margin-right: 6px; }
.attachment-pill { display: inline-block; padding: 2px 6px; border-radius: 999px; background: rgba(80,120,255,0.12); color: #2b59c3; font-size: 0.7rem; margin-right: 6px; }
.pomodoro-task-picker { display: none; }
.pomodoro-task-picker.open { display: block; }
.pomodoro-task-picker {
    position: absolute;
    top: 78px;
    left: 50%;
    transform: translateX(-50%);
    width: min(320px, 92%);
    z-index: 6;
}
.pomodoro-task-list {
    max-height: 160px;
    overflow-y: auto;
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 10px;
    background: rgba(255,255,255,0.9);
    text-align: left;
    padding: 6px;
}
.pomodoro-task-item {
    width: 100%;
    border: none;
    background: transparent;
    padding: 6px 8px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    color: #333;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.pomodoro-task-item:hover { background: rgba(0,0,0,0.06); }
.pomodoro-task-item.active { background: rgba(0,122,255,0.12); color: var(--primary); }
.pomodoro-task-empty { font-size: 0.8rem; color: #777; padding: 8px; }
.pomodoro-settings.highlight { box-shadow: 0 0 0 2px rgba(0,122,255,0.35); }
.pomodoro-dashboard {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    grid-template-rows: repeat(2, minmax(0, 1fr));
    gap: 12px;
    padding: 0;
    border-radius: 16px;
    background: transparent;
    overflow: hidden;
    aspect-ratio: 1 / 1;
    min-height: 360px;
    height: 100%;
    align-self: stretch;
}
.pomodoro-dashboard .stats-card {
    margin: 0;
    border-radius: 12px;
    background: rgba(255,255,255,0.9);
    border: 1px solid rgba(0,0,0,0.05);
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    padding: 14px 16px;
    overflow: auto;
}
.pomodoro-history,
.pomodoro-completed {
    max-height: 220px;
}
.pomodoro-history #pomodoro-recent-list,
.pomodoro-completed #pomodoro-completed-list {
    max-height: 160px;
    overflow-y: auto;
    padding-right: 4px;
}
.pomodoro-history #pomodoro-recent-list::-webkit-scrollbar,
.pomodoro-completed #pomodoro-completed-list::-webkit-scrollbar {
    width: 6px;
}
.pomodoro-history #pomodoro-recent-list::-webkit-scrollbar-thumb,
.pomodoro-completed #pomodoro-completed-list::-webkit-scrollbar-thumb {
    background: rgba(0,0,0,0.18);
    border-radius: 6px;
}

@media (max-width: 900px) {
    .pomodoro-swipe {
        display: flex;
        gap: 0;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 4px;
    }
    .pomodoro-swipe::-webkit-scrollbar { display: none; }
    .pomodoro-screen {
        flex: 0 0 100%;
        scroll-snap-align: start;
        padding: 0 6px;
        box-sizing: border-box;
    }
    .pomodoro-swipe-dots { display: flex; }
    .pomodoro-setting-row { grid-template-columns: 1fr; }
    .pomodoro-progress { width: 280px; height: 280px; }
    .pomodoro-timer { font-size: 1.8rem; }
    .pomodoro-task-list { max-height: 140px; }
    .pomodoro-dashboard { aspect-ratio: auto; min-height: 0; }
}
@media (max-height: 820px) {
    .pomodoro-panel { padding: 16px 12px; }
    .pomodoro-progress { width: min(360px, 100%); height: min(360px, 45vh); margin: 6px auto 10px; }
    .pomodoro-action-btn { width: 48px; height: 48px; }
    .pomodoro-timer { transform: translateY(60px); }
    .pomodoro-task-title { font-size: 0.95rem; }
    .pomodoro-task-hint { margin-bottom: 4px; }
    .pomodoro-cycle { margin-bottom: 6px; }
    .pomodoro-controls { margin: 6px 0 4px; }
    .pomodoro-toggle { margin-top: 6px; }
    .pomodoro-dashboard { aspect-ratio: auto; min-height: 0; height: auto; }
}

.attachment-controls {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}
.attachment-upload input[type="file"] {
    display: none;
}
.attachment-upload.disabled {
    opacity: 0.6;
    pointer-events: none;
}
.attachment-hint {
    font-size: 0.8rem;
    color: #777;
}
.attachment-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 8px;
}
.attachment-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 8px 10px;
    border-radius: 8px;
    background: #f6f6f6;
}
.attachment-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
    min-width: 0;
}
.attachment-name {
    font-size: 0.92rem;
    font-weight: 600;
    color: #333;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.attachment-meta {
    font-size: 0.78rem;
    color: #777;
}
.attachment-actions {
    display: flex;
    gap: 6px;
    flex-shrink: 0;
}
.attachment-empty {
    font-size: 0.85rem;
    color: #777;
}
